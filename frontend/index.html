<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Deal Inspection App</title><script src="https://cdn.tailwindcss.com"></script>
</head><body class="bg-gray-50 text-gray-900"><div class="max-w-6xl mx-auto p-6 space-y-6">
<header class="flex items-center justify-between"><h1 class="text-2xl font-bold">Deal Inspection App</h1>
<span id="status" class="px-3 py-1 rounded-full text-sm bg-gray-200">Ready</span></header>
<section class="grid md:grid-cols-2 gap-6"><div class="space-y-4">
<div class="bg-white rounded-2xl shadow p-4 space-y-3"><h2 class="font-semibold">Capture Mode</h2>
<div class="flex gap-4 items-center">
<label class="flex items-center gap-2"><input type="radio" name="mode" value="mic" checked class="accent-blue-600"/><span>Option A — Mic only</span></label>
<label class="flex items-center gap-2"><input type="radio" name="mode" value="tab" class="accent-blue-600"/><span>Option B — Teams web tab + mic (Chrome/Edge)</span></label>
</div><p class="text-sm text-gray-600">Tip: Click <strong>Initialize</strong>, pick the Teams tab, and enable <em>Also share tab audio</em>.</p></div>
<div class="bg-white rounded-2xl shadow p-4 space-y-3"><h2 class="font-semibold">Controls</h2>
<div class="flex flex-wrap gap-2">
<button id="btnInit" class="px-4 py-2 rounded-2xl shadow bg-blue-600 text-white">Initialize</button>
<button id="btnStart" class="px-4 py-2 rounded-2xl shadow bg-green-600 text-white" disabled>Start</button>
<button id="btnStop" class="px-4 py-2 rounded-2xl shadow bg-red-600 text-white" disabled>Stop</button>
<button id="btnTranscribe" class="px-4 py-2 rounded-2xl shadow bg-indigo-600 text-white" disabled>Transcribe & Extract</button>
</div><div class="text-sm text-gray-700">Timer: <span id="timer">00:00:00</span></div>
<div class="pt-2"><label class="block text-sm font-medium text-gray-700">Upload pre-recorded audio</label><input id="fileInput" type="file" accept="audio/*" class="mt-1"/></div></div>
<div class="bg-white rounded-2xl shadow p-4 space-y-3"><h2 class="font-semibold">Playback</h2><audio id="player" controls class="w-full"></audio></div>
</div><div class="space-y-4">
<div class="bg-white rounded-2xl shadow p-4 space-y-3"><h2 class="font-semibold">Results</h2><div id="results" class="space-y-3"><p class="text-sm text-gray-600">Run <em>Transcribe & Extract</em> to see results.</p></div></div>
<div class="bg-white rounded-2xl shadow p-4 space-y-3"><h2 class="font-semibold">Exports</h2>
<div class="flex gap-2">
<button id="btnExportJson" class="px-3 py-2 rounded-xl bg-gray-800 text-white disabled:opacity-50" disabled>JSON</button>
<button id="btnExportCsv" class="px-3 py-2 rounded-xl bg-gray-800 text-white disabled:opacity-50" disabled>CSV</button>
<button id="btnExportMd" class="px-3 py-2 rounded-xl bg-gray-800 text-white disabled:opacity-50" disabled>Markdown</button>
</div></div></div></section>
<footer class="text-xs text-gray-500"><p>Chrome/Edge recommended for Option B. HTTPS or localhost required.</p></footer></div>
<script>
const statusEl=document.getElementById('status');const btnInit=document.getElementById('btnInit');const btnStart=document.getElementById('btnStart');const btnStop=document.getElementById('btnStop');const btnTranscribe=document.getElementById('btnTranscribe');const timerEl=document.getElementById('timer');const player=document.getElementById('player');const fileInput=document.getElementById('fileInput');const results=document.getElementById('results');const btnExportJson=document.getElementById('btnExportJson');const btnExportCsv=document.getElementById('btnExportCsv');const btnExportMd=document.getElementById('btnExportMd');
let selectedMode='mic';let ctx,sysStream,micStream,mixedStream,mediaRecorder;let chunks=[];let timerInterval,startTime;let lastResult=null;
document.querySelectorAll('input[name="mode"]').forEach(r=>r.addEventListener('change',e=>{selectedMode=e.target.value;}));
function setStatus(s){statusEl.textContent=s;statusEl.className='px-3 py-1 rounded-full text-sm '+(s==='Recording'?'bg-red-100 text-red-700':s==='Ready'?'bg-gray-200':s==='Stopped'?'bg-yellow-100 text-yellow-700':'bg-gray-200');}
function fmt(ms){const t=Math.floor(ms/1000);const h=(''+Math.floor(t/3600)).padStart(2,'0');const m=(''+Math.floor((t%3600)/60)).padStart(2,'0');const s=(''+t%60).padStart(2,'0');return `${h}:${m}:${s}`;}
function startTimer(){startTime=Date.now();timerInterval=setInterval(()=>{timerEl.textContent=fmt(Date.now()-startTime);},250);}function stopTimer(){clearInterval(timerInterval);}
async function initCapture(){setStatus('Initializing…');if(!window.isSecureContext&&location.hostname!=='localhost'){alert('Use HTTPS or localhost for tab/system audio capture.');}btnInit.disabled=true;try{if(selectedMode==='tab'){sysStream=await navigator.mediaDevices.getDisplayMedia({video:{cursor:'never'},audio:true});micStream=await navigator.mediaDevices.getUserMedia({audio:true});ctx=new AudioContext();const sysSrc=ctx.createMediaStreamSource(sysStream);const micSrc=ctx.createMediaStreamSource(micStream);const dest=ctx.createMediaStreamDestination();sysSrc.connect(dest);micSrc.connect(dest);mixedStream=dest.stream;}else{mixedStream=await navigator.mediaDevices.getUserMedia({audio:true});}btnStart.disabled=false;setStatus('Ready');}catch(err){console.error(err);alert('Initialization failed. Falling back to Mic-only.\n'+(err&&err.message?err.message:err));try{mixedStream=await navigator.mediaDevices.getUserMedia({audio:true});btnStart.disabled=false;setStatus('Ready');}catch(e){console.error(e);setStatus('Ready');btnInit.disabled=false;alert('Mic access failed. Check browser permissions.');}}finally{if(btnStart.disabled)btnInit.disabled=false;}}
function startRecording(){chunks=[];let opts={mimeType:'audio/webm'};try{mediaRecorder=new MediaRecorder(mixedStream,opts);}catch(e){mediaRecorder=new MediaRecorder(mixedStream);}mediaRecorder.ondataavailable=e=>{if(e.data&&e.data.size>0)chunks.push(e.data);};mediaRecorder.onstop=()=>{const blob=new Blob(chunks,{type:'audio/webm'});player.src=URL.createObjectURL(blob);player.load();btnTranscribe.disabled=true;/* disabled until backend available */};mediaRecorder.start(1000);btnStart.disabled=true;btnStop.disabled=false;setStatus('Recording');startTimer();}
function stopRecording(){stopTimer();if(mediaRecorder&&mediaRecorder.state!=='inactive'){mediaRecorder.stop();}btnStop.disabled=true;btnStart.disabled=false;setStatus('Stopped');}
btnInit.addEventListener('click',initCapture);btnStart.addEventListener('click',startRecording);btnStop.addEventListener('click',stopRecording);
</script></body></html>
